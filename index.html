<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PangChat Room</title>
<style>
body { background:#111; color:white; font-family:sans-serif; display:flex; flex-direction:column; align-items:center; padding:20px;}
#chatContainer { width:90%; max-width:600px; height:400px; overflow-y:auto; background:#222; padding:10px; border-radius:10px; margin-bottom:10px;}
.message { margin:5px 0; padding:5px; border-radius:5px; }
img { max-width:100%; border-radius:6px; margin-top:4px; }
#inputRow { display:flex; width:90%; max-width:600px; }
#nameInput, #textInput { padding:8px; border-radius:5px; border:none; margin-right:5px; flex:1; }
#sendBtn { padding:8px 15px; border:none; border-radius:5px; background:#00f; color:#fff; cursor:pointer; }
#imageInput { margin-top:4px; }
</style>
</head>
<body>

<h2>PangChat Room</h2>
<div id="chatContainer"></div>

<div id="inputRow">
<input id="nameInput" placeholder="Your name" />
<input id="textInput" placeholder="Type a message..." />
<button id="sendBtn">Send</button>
</div>
<input type="file" id="imageInput" accept="image/*" />

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBpDQlmOZHQrdRQF1mQPk_aPgxwb6gbheY",
  authDomain: "pangai.firebaseapp.com",
  projectId: "pangai",
  storageBucket: "pangai.firebasestorage.app",
  messagingSenderId: "456349287523",
  appId: "1:456349287523:web:e0a252e4b55f3dd294e456"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

const chatContainer = document.getElementById('chatContainer');
const nameInput = document.getElementById('nameInput');
const textInput = document.getElementById('textInput');
const sendBtn = document.getElementById('sendBtn');
const imageInput = document.getElementById('imageInput');

// Render a message
function renderMessage(doc){
    const data = doc.data();
    const div = document.createElement('div');
    div.className = 'message';
    div.style.background = '#444';
    div.style.padding = '6px';
    div.style.borderRadius = '6px';

    const nameP = document.createElement('p');
    nameP.textContent = data.name + ":";
    nameP.style.fontWeight = 'bold';
    nameP.style.margin = '0';
    div.appendChild(nameP);

    if(data.text){
        const textP = document.createElement('p');
        textP.textContent = data.text;
        textP.style.margin='2px 0 0 0';
        div.appendChild(textP);
    }
    if(data.imageUrl){
        const img = document.createElement('img');
        img.src = data.imageUrl;
        div.appendChild(img);
    }

    chatContainer.appendChild(div);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

// Real-time listener
db.collection('messages').orderBy('timestamp').onSnapshot(snapshot=>{
    chatContainer.innerHTML='';
    snapshot.forEach(doc=>renderMessage(doc));
});

// Send message function
async function sendMessage(){
    const name = nameInput.value.trim() || "Anonymous";
    const text = textInput.value.trim();

    if(text==="/clearchat"){
        const snapshot = await db.collection('messages').get();
        snapshot.forEach(doc=>doc.ref.delete());
        textInput.value='';
        return;
    }

    let imageUrl = null;
    if(imageInput.files[0]){
        const file = imageInput.files[0];
        const fileRef = storage.ref('images/'+Date.now()+'_'+file.name);
        await fileRef.put(file);
        imageUrl = await fileRef.getDownloadURL();
        imageInput.value='';
    }

    if(!text && !imageUrl) return;

    db.collection('messages').add({
        name,
        text,
        imageUrl: imageUrl || null,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    textInput.value='';
}

// Send button click
sendBtn.onclick = sendMessage;

// Enter key sends message
textInput.addEventListener('keydown', e=>{
    if(e.key==="Enter") sendMessage();
});
</script>
</body>
</html>
